<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>

  <title>SeamNet o_O</title>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  <script type="text/javascript">
    sessionStorage.setItem("hash", "{{ hash }}");
  </script>

  <link rel="stylesheet" href="../static/styles.css">

  <script type="text/javascript">
    var count = 0;
    function change_camera() {
      count++;
      if (count == 0) {
        document.getElementById("feed").src = "{{ url_for('video_feed', cam='Driveway') }}";
      } else if (count == 1) {
        document.getElementById("feed").src = "{{ url_for('video_feed', cam='Front_Porch') }}";
      } else if (count == 2) {
        document.getElementById("feed").src = "{{ url_for('video_feed', cam='SW_Yard') }}";
      } else if (count == 3) {
        document.getElementById("feed").src = "{{ url_for('video_feed', cam='W_Porch') }}";
      } else if (count == 4) {
        document.getElementById("feed").src = "{{ url_for('video_feed', cam='N_Yard') }}";
      } else if (count == 5) {
        document.getElementById("feed").src = "{{ url_for('video_feed', cam='NE_Yard') }}";
        count = -1;
      }
    }
  </script>

  <script>
    function set_active_cam() {
      var camera = String(document.getElementById("feed").src)
      $.post( "/active_cam", {
        active_cam: camera 
      });
    }
  </script>

  <script>
    function submitPoll(id){
      document.getElementById("next").disabled = true;
      document.getElementById('next').innerHTML = "Loading...";
      setTimeout(function(){document.getElementById("next").disabled = false;},500);
      setTimeout(function(){document.getElementById("next").innerHTML = "Next Camera";},500);
    }
  </script>
</head>

<body>
  <!-- Header -->
  <div id="navbar"></div>

  <div class="content">
    <div>
      <h1 class="h1">Surveillance Feed</h1>
    </div>

    <div>
      <img id="feed" style="zoom: 135%;" src="{{ url_for('video_feed', cam='Driveway') }}" class = "marginauto" alt="centered image">
    </div>

    <div id="detection-indicator" class="indicator">
      <span id="detection-text">Detection: </span>
      <span id="detection-state">-</span>
    </div>

    <div style="text-align: center;" class = "marginauto">
      <button id="next" class="button-81" style="font-size: 1.5rem;" role="button" onclick="change_camera(); submitPoll(); getDetectionState()">Next Camera</button>
    </div>
  </div>

  <br>
  <br>
  <br>

  <div id="footer"></div>

  <script>
    // Load header and footer on page load
    $(function(){
        $("#navbar").load("/static/navbar.html");
        $("#footer").load("/static/footer.html");
      });

      window.onload = function() {
        getDetectionState()
      };

      function getDetectionState() {
        var url_split = document.getElementById("feed").src.split("/");
        var cam = url_split[url_split.length - 2]

        fetch('get_camera_data/' + cam)
        .then((response) => {
          return response.json();
        })
        .then((data) => {
          var stateText = document.getElementById("detection-state");
          stateText.innerText = data.success;

          var indicator = document.getElementById("detection-indicator");

          if (data.success === "ON") {
            indicator.style.backgroundColor = "rgb(121, 196, 137)";
            indicator.style.color = "white";
          } else {
            indicator.style.backgroundColor = "#F2F2F2";
            indicator.style.color = "black";
          }
        })
      }
  </script>

</body>
</html>
